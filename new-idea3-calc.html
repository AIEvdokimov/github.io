<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
    <h1>Графики функций (одинаковый масштаб X/Y)</h1>
    
    <input id="x" class="form-control w-25 d-inline" type="number" step="0.5" min="1" max="8" value="3">
    <button onclick="drawGraphs()" class="btn btn-success ms-2">Построить</button>
    
    <canvas id="chart" width="800" height="600" class="mt-4 border"></canvas>

    <script>
    let chart;
    
    function drawGraphs() {
        const maxX = parseFloat(document.getElementById('x').value);
        const step = 0.1;
        
        // Данные от -maxX до +maxX
        const xValues = [];
        const x2Values = [];
        const x3Values = [];
        const sqrtValues = [];
        const sinValues = [];
        
        for (let x = -maxX; x <= maxX; x += step) {
            xValues.push(x.toFixed(1));
            x2Values.push(x * x);
            x3Values.push(x * x * x);
            sqrtValues.push(x >= 0 ? Math.sqrt(x) : null);
            sinValues.push(Math.sin(x));
        }
        
        // ✅ ОДИНАКОВЫЙ МАСШТАБ X/Y!
        const maxY = Math.max(
            Math.max(...x2Values),
            Math.abs(Math.min(...x2Values)),
            Math.max(...x3Values),
            Math.abs(Math.min(...x3Values))
        );
        
        const ctx = document.getElementById('chart').getContext('2d');
        if (chart) chart.destroy();
        
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: xValues,
                datasets: [
                    { label: 'x²', data: x2Values, borderColor: 'red', fill: false, tension: 0.1 },
                    { label: 'x³', data: x3Values, borderColor: 'blue', fill: false, tension: 0.1 },
                    { label: '√x', data: sqrtValues, borderColor: 'green', fill: false, tension: 0.1, borderDash: [5, 5] },
                    { label: 'sin(x)', data: sinValues, borderColor: 'purple', fill: false, tension: 0.4 }
                ]
            },
            options: {
                responsive: false,  // ✅ Фиксированный размер!
                maintainAspectRatio: false,
                scales: {
                    x: {
                        min: -maxX,
                        max: maxX,
                        grid: {
                            color: (context) => context.tick.value === 0 ? 'black' : 'rgba(0,0,0,0.1)'
                        },
                        ticks: { stepSize: 1 }
                    },
                    y: {
                        // ✅ ОДИНАКОВЫЙ диапазон с X!
                        min: -maxY,
                        max: maxY,
                        grid: {
                            color: (context) => context.tick.value === 0 ? 'black' : 'rgba(0,0,0,0.1)'
                        },
                        ticks: { stepSize: Math.ceil(maxY / 5) }
                    }
                },
                plugins: {
                    legend: { 
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`
                        }
                    }
                }
            }
        });
    }
    
    drawGraphs();
    </script>
</body>
</html>
