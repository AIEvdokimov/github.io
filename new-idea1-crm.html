<!DOCTYPE html>
<html>
<head>
    <!-- Корпоративный стек -->
     <!-- пример: CRM на GitHub Pages --> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">DVD Rental CRM</a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Форма добавления -->
        <div class="row mb-4">
            <div class="col-md-4">
                <input id="filmName" class="form-control" placeholder="Название фильма">
            </div>
            <div class="col-md-2">
                <input id="filmPrice" type="number" class="form-control" placeholder="Цена">
            </div>
            <div class="col-md-2">
                <button onclick="addFilm()" class="btn btn-success w-100">Добавить</button>
            </div>
            <div class="col-md-2">
                <button onclick="exportPDF()" class="btn btn-info w-100">PDF</button>
            </div>
        </div>

        <!-- Дашборд -->
        <div class="row">
            <div class="col-md-8">
                <div id="chart" style="height: 400px;"></div>
            </div>
            <div class="col-md-4">
                <table class="table table-hover">
                    <thead><tr><th>Фильм</th><th>Цена</th></tr></thead>
                    <tbody id="films"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
    let films = JSON.parse(localStorage.getItem('films')) || [];
    updateUI();

    function addFilm() {
        const name = document.getElementById('filmName').value;
        const price = parseFloat(document.getElementById('filmPrice').value);
        films.push({name, price, date: new Date().toLocaleDateString()});
        localStorage.setItem('films', JSON.stringify(films));
        updateUI();
    }

    function updateUI() {
        // Таблица
        document.getElementById('films').innerHTML = 
            films.map(f => `<tr><td>${f.name}</td><td>${f.price}₽</td></tr>`).join('');

        // График
        const chart = echarts.init(document.getElementById('chart'));
        chart.setOption({
            title: { text: 'Аналитика' },
            xAxis: { data: films.map(f => f.date.slice(0,5)) },
            yAxis: {},
            series: [{ type: 'bar', data: films.map(f => f.price) }]
        });
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text('Отчёт по фильмам', 20, 20);
        let y = 40;
        films.forEach(f => {
            doc.text(`${f.name}: ${f.price}₽`, 20, y);
            y += 10;
        });
        doc.save('films.pdf');
    }
    </script>
</body>
</html>
